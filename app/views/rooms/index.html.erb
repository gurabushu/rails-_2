<div class="header-bar">
  <div class="list-info">
    <h1>施設一覧</h1>
    <p>検索結果：<%= @rooms.count %>件</p>
  </div>
  <div class="welcome-info">
    <div class="welcome-flex">
      <% if user_signed_in? %>
        <div class="user-dropdown">
          <div class="user-icon-wrapper">
            <% if current_user.img.attached? %>
              <%= image_tag current_user.img, width: 32, height: 32, class: "user-icon" %>
            <% else %>
              <%= image_tag "icon-default.png", width: 32, height: 32, class: "user-icon" %>
            <% end %>
            <div class="dropdown-menu">
              <%= link_to "アカウント", user_path(current_user), class: "dropdown-item" %>
              <%= link_to "プロフィール", profile_user_path(current_user), class: "dropdown-item" %>
              <%= link_to "予約履歴", user_reservations_path(current_user), class: "dropdown-item" %>
              <%= link_to "登録した施設", user_rooms_path(current_user), class: "dropdown-item" %>
              <%= form_with url: destroy_user_session_path, method: :delete, local: true do %>
                <button type="submit" class="dropdown-item" style="background:none;border:none;padding:8px 16px;width:100%;text-align:left;">ログアウト</button>
              <% end %>
            </div>
          </div>
          <span class="dropdown-toggle" style="margin-left:8px;">ようこそ、<%= current_user.name %> さん</span>
        </div>
      <% else %>
        <%= link_to "ログイン", new_user_session_path, class: "btn btn-outline-primary" %>
        <%= link_to "新規登録", new_user_registration_path, class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>
<div class="header-underline"></div>

<%= form_with url: rooms_path, method: :get, local: true do %>
  <div class="search-form-row">
    <div class="form-group">
      <%= label_tag :keyword, "フリーワード検索" %>
      <%= text_field_tag :keyword, params[:keyword], class: "form-control", placeholder: "施設名・説明・住所など" %>
    </div>
    <div class="form-group">
      <%= label_tag :area, "エリアで絞り込み" %>
      <%= select_tag :area, options_for_select(["", "東京", "京都", "大阪", "札幌"], params[:area]), class: "form-control" %>
    </div>
    <div class="form-group">
      <%= label_tag :postal_code, "郵便番号で検索" %>
      <%= text_field_tag :postal_code, params[:postal_code], class: "form-control", placeholder: "例: 123-4567" %>
    </div>
    <%= submit_tag "検索", class: "btn btn-primary" %>
  </div>
<% end %>

<div class="rooms-list">
  <% @rooms.each do |room| %>
    <div class="room-card">
      <h2 class="room-name">
        <%= link_to room.name, room_path(room), class: "room-link" %>
      </h2>
      <p class="room-address">住所: <%= room.address %></p>
      <p class="room-description">施設詳細: <%= room.description %></p>
      <p class="room-cash">宿泊料金: <%= number_to_currency(room.cash, unit: "¥", precision: 0) %>/日</p>
      <% if room.img.attached? %>
        <%= image_tag room.img, width: 200, class: "room-img" %>
      <% else %>
        <%= image_tag "default_img.png", width: 200, class: "room-img" %>
      <% end %>
    </div>
  <% end %>
</div>

<div class="pageout">
<%= link_to "検索条件をクリアして一覧に戻る", rooms_path, class: "btn btn-secondary", style: "margin-bottom: 16px;" %>

<% if user_signed_in? %>
  <%= link_to "新規施設登録", new_room_path, class: "btn btn-success", style: "margin-bottom: 16px;" %>
<% end %>
</div>
