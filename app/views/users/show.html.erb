<h1><%= @user.name %> さんのプロフィール</h1>

<div class="user-info">
  <p>名前：<%= @user.name %></p>
  <p>メールアドレス：<%= @user.email %></p>
  <p>パスワード：＊＊＊＊＊＊＊</p>
  <p>自己紹介: <%= @user.profile.presence || "未登録" %></p>
  
</div>

<div class="actions">
  <%= link_to "削除", user_path(@user), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger" %>
  <%= link_to "編集", edit_user_path(@user), class: "btn btn-secondary" %>
</div>

<h2>予約した施設</h2>
<% if @reservations.any? %>
  <table class="table">
    <thead>
      <tr>
        <th>施設名</th>
        <th>開始日時</th>
        <th>終了日時</th>
        <th>人数</th>
        <th>支払い金額</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @reservations.each do |reservation| %>
        <tr>
          <td><%= reservation.room&.name %></td>
          <td><%= reservation.start_time %></td>
          <td><%= reservation.end_time %></td>
          <td><%= reservation.person %></td>
          <td>
            <% if reservation.room.present? %>
              <% start_date = reservation.start_time.to_date %>
              <% end_date = reservation.end_time.to_date %>
              <% total = 0 %>
              <% (start_date...end_date).each do |date| %>
                <% price = reservation.room.room_prices.find_by(date: date)&.price || reservation.room.cash %>
                <% total += price %>
              <% end %>
              <%= number_to_currency(total * reservation.person, unit: "¥", precision: 0) %>
            <% else %>
              施設情報なし
            <% end %>
          </td>
          <td>
            <% if reservation.room.present? %>
              <%= form_with url: room_reservation_path(reservation.room, reservation), method: :delete, data: { turbo: false }, class: "d-inline" do %>
                <%= submit_tag "削除", class: "btn btn-danger btn-sm", data: { confirm: "本当に削除しますか？" } %>
              <% end %>
            <% else %>
              -
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>    <% if @reservations.any? %>
      <% @reservations.each do |reservation| %>
        <!-- 予約情報の表示 -->
      <% end %>
    <% else %>
      <p>予約した施設はありません。</p>
    <% end %>
  </table>
<% else %>
  <p>予約した施設はありません。</p>
<% end %>

<h2>登録した施設</h2>
<% if @owned_rooms.any? %>
  <table class="table">
    <thead>
      <tr>
        <th>施設名</th>
        <th>説明</th>
        <th>料金</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <% @owned_rooms.each do |room| %>
        <tr>
          <td><%= room.name %></td>
          <td><%= room.description %></td>
          <td><%= number_to_currency(room.cash, unit: "¥", precision: 0) %></td>
          <td>
            <%= link_to "詳細", room_path(room), class: "btn btn-primary btn-sm" %>
            <%= link_to "編集", edit_room_path(room), class: "btn btn-secondary btn-sm" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>登録した施設はありません。</p>
<% end %>

<%= link_to "施設一覧に戻る", rooms_path, class: "btn btn-secondary" %>